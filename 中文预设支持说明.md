# 中文预设支持说明

## 完全支持中文预设！✅

程序已经完全支持中文预设名称和中文路径，所有字符串都经过正确的 UTF-8 ↔ UTF-16 转换。

## 使用中文预设

### 方法 1：使用提供的中文预设文件

将 `presets_中文.json` 重命名为 `presets.json`（或合并到现有的 presets.json）：

```json
{
  "代码文件": {
    "mode": "whitelist",
    "extensions": [".py", ".cpp", ".js", ".html", ...]
  },
  "文档": {
    "mode": "whitelist",
    "extensions": [".doc", ".pdf", ".txt", ...]
  },
  "图片": {
    "mode": "whitelist",
    "extensions": [".jpg", ".png", ".gif", ...]
  }
}
```

### 方法 2：自定义中文预设

编辑 `presets.json`，添加你自己的中文预设：

```json
{
  "我的项目": {
    "mode": "whitelist",
    "extensions": [".cpp", ".h", ".txt"]
  },
  "工作文档": {
    "mode": "whitelist",
    "extensions": [".docx", ".xlsx", ".pdf"]
  },
  "排除临时文件": {
    "mode": "blacklist",
    "extensions": [".tmp", ".bak", ".log"]
  }
}
```

## 中文预设示例

### 编程语言类

```json
{
  "C++项目": {
    "mode": "whitelist",
    "extensions": [".cpp", ".h", ".hpp", ".cmake"]
  },
  "Python项目": {
    "mode": "whitelist",
    "extensions": [".py", ".ipynb", ".txt", ".md"]
  },
  "Web前端": {
    "mode": "whitelist",
    "extensions": [".html", ".css", ".js", ".vue"]
  },
  "Java项目": {
    "mode": "whitelist",
    "extensions": [".java", ".xml", ".properties"]
  }
}
```

### 文件类型类

```json
{
  "办公文档": {
    "mode": "whitelist",
    "extensions": [".doc", ".docx", ".xls", ".xlsx", ".ppt", ".pptx"]
  },
  "设计文件": {
    "mode": "whitelist",
    "extensions": [".psd", ".ai", ".sketch", ".fig"]
  },
  "多媒体": {
    "mode": "whitelist",
    "extensions": [".mp4", ".mp3", ".jpg", ".png"]
  }
}
```

### 排除类

```json
{
  "排除系统文件": {
    "mode": "blacklist",
    "extensions": [".tmp", ".cache", ".DS_Store", "thumbs.db"]
  },
  "排除编译产物": {
    "mode": "blacklist",
    "extensions": [".o", ".obj", ".exe", ".dll"]
  }
}
```

## 在 GUI 中使用

### 1. 查看中文预设

1. 右键托盘图标 → "备份格式"
2. 可以看到所有中文预设名称正确显示

### 2. 添加中文预设到备份源

1. 右键托盘图标 → "备份设置"
2. 点击"添加"或"配置"
3. 在"可用预设"列表中看到中文预设
4. 双击中文预设名称添加
5. 例如：双击"代码文件"、"文档"、"图片"等

### 3. 中文路径支持

程序完全支持中文路径，例如：
- `D:\我的项目\测试项目`
- `C:\用户\张三\文档`
- `E:\工作文件\重要资料`

## 技术实现

### UTF-8 ↔ UTF-16 转换

程序内部使用了两个辅助函数：

```cpp
// UTF-8 (JSON, 配置文件) → UTF-16 (Windows GUI)
std::wstring Utf8ToWide(const std::string& utf8str);

// UTF-16 (Windows GUI) → UTF-8 (JSON, 配置文件)
std::string WideToUtf8(const std::wstring& wstr);
```

### 转换位置

所有需要显示或输入中文的地方都经过了正确转换：

1. **预设名称显示**：从 JSON 读取 → 转换 → 显示在列表
2. **路径显示**：从配置读取 → 转换 → 显示在界面
3. **用户输入**：从界面获取 → 转换 → 保存到配置
4. **错误消息**：从异常获取 → 转换 → 显示给用户

## 配置文件编码

### 重要提示

确保配置文件使用 **UTF-8 编码**（无 BOM）：

- ✅ `config.json` - UTF-8 编码
- ✅ `presets.json` - UTF-8 编码
- ✅ `presets_中文.json` - UTF-8 编码

### 如何确保 UTF-8 编码

#### 使用 Visual Studio Code
1. 打开文件
2. 右下角点击编码
3. 选择"通过编码保存"
4. 选择"UTF-8"

#### 使用记事本
1. 打开文件
2. 文件 → 另存为
3. 编码选择"UTF-8"（不是 UTF-8 with BOM）

#### 使用 Notepad++
1. 打开文件
2. 编码 → 转为 UTF-8（无 BOM）

## 完整示例配置

### presets.json（中英混合）

```json
{
  "default": {
    "mode": "none",
    "extensions": []
  },
  "代码文件": {
    "mode": "whitelist",
    "extensions": [".cpp", ".h", ".py", ".js"]
  },
  "文档": {
    "mode": "whitelist",
    "extensions": [".doc", ".docx", ".pdf", ".txt"]
  },
  "cpp": {
    "mode": "whitelist",
    "extensions": [".cpp", ".h", ".hpp"]
  },
  "排除临时": {
    "mode": "blacklist",
    "extensions": [".tmp", ".bak", ".log"]
  }
}
```

### config.json（中文路径）

```json
{
  "backup_destination_base": "D:\\备份",
  "backup_sources": [
    {
      "path": "D:\\我的项目\\测试",
      "enabled": true,
      "presets": ["代码文件", "排除临时"]
    },
    {
      "path": "C:\\用户\\文档\\重要文件.txt",
      "enabled": true,
      "presets": []
    }
  ]
}
```

## 测试步骤

### 1. 测试中文预设显示

```bash
# 1. 复制中文预设文件
copy presets_中文.json presets.json

# 2. 运行程序
.\build\Release\main_gui.exe

# 3. 查看预设
右键托盘 → "备份格式"
```

应该看到：
- 【代码文件】
- 【文档】
- 【图片】
- 等等...

### 2. 测试中文预设添加

```bash
# 1. 打开设置
右键托盘 → "备份设置"

# 2. 添加备份源
点击"添加" → 选择文件夹

# 3. 添加中文预设
在"可用预设"中双击"代码文件"
点击"确定"和"保存"
```

### 3. 测试中文路径

```bash
# 1. 创建中文路径测试文件夹
mkdir "D:\测试文件夹"

# 2. 添加为备份源
在 GUI 中选择这个文件夹

# 3. 检查配置文件
打开 config.json，应该看到正确的中文路径
```

## 常见问题

### Q: 中文显示为乱码
A: 检查 JSON 文件是否使用 UTF-8 编码（无 BOM）

### Q: 预设名称显示为方框
A: 
1. 确保系统安装了中文字体
2. 检查 JSON 文件编码
3. 重新编译程序

### Q: 中文路径无法保存
A: 
1. 确保路径确实存在
2. 检查是否有写入权限
3. 查看日志文件

### Q: 混合使用中英文预设
A: 完全支持！可以同时使用中文和英文预设名称

## 优势

1. **直观易懂**：中文预设名称更容易理解
2. **本地化**：适合中文用户使用
3. **灵活性**：可以中英文混用
4. **兼容性**：不影响现有英文预设

## 建议

1. **预设命名**：使用简短、描述性的中文名称
2. **分类清晰**：按用途分类（如"工作"、"学习"、"个人"）
3. **避免特殊字符**：虽然支持，但建议避免使用特殊符号
4. **备份配置**：修改前备份 presets.json

## 总结

✅ 完全支持中文预设名称
✅ 完全支持中文路径
✅ 正确的 UTF-8 ↔ UTF-16 转换
✅ 中英文可以混用
✅ 界面正确显示中文

现在你可以自由使用中文预设，让备份配置更加直观易懂！
