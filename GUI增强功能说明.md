# GUI 界面增强功能说明

## 新增功能

### 1. 源配置对话框 ✨
现在可以为每个备份源进行详细配置，包括：

#### 路径/文件选择
- **选择文件夹**：备份整个文件夹
- **选择文件**：备份单个文件
- 支持手动输入路径

#### 启用/禁用
- 复选框控制是否启用此备份源
- 禁用的源不会被监控

#### 预设管理
- 显示所有可用预设（从 presets.json 加载）
- 双击预设名称即可添加到当前源
- 可以为一个源添加多个预设
- 预设会自动合并文件类型过滤规则

#### 自定义文件类型过滤
- **三种模式**：
  - **白名单**：仅备份指定的文件类型
  - **黑名单**：排除指定的文件类型
  - **无**：备份所有文件

- **扩展名管理**：
  - 手动添加文件扩展名（如 .cpp, .h, .txt）
  - 自动添加点号（输入 cpp 会自动变成 .cpp）
  - 可以删除已添加的扩展名
  - 支持任意文件类型

### 2. 改进的设置界面

#### 新增"配置"按钮
- 选中列表中的备份源后，点击"配置"按钮
- 打开源配置对话框进行详细设置
- 可以修改路径、预设、文件类型等

#### 简化的"添加"按钮
- 点击"添加"按钮直接打开源配置对话框
- 在对话框中完成所有配置后再添加到列表
- 避免了多次对话框操作

#### 优化的按钮布局
```
┌─────────────────┐
│   添加 (30px)   │
├─────────────────┤
│   配置 (30px)   │
├─────────────────┤
│   删除 (30px)   │
└─────────────────┘
```

### 3. 移除调试代码
- 清理了所有调试 MessageBox
- 保留了 OutputDebugString 用于开发调试
- 界面更加流畅，无干扰

## 使用流程

### 添加新的备份源

1. **打开设置**
   - 右键托盘图标 → "备份设置"

2. **点击"添加"按钮**
   - 打开源配置对话框

3. **选择路径或文件**
   - 点击"选择文件夹"：备份整个文件夹
   - 点击"选择文件"：备份单个文件
   - 或直接输入路径

4. **配置预设（可选）**
   - 在左侧"可用预设"列表中双击预设名称
   - 或点击"添加预设"按钮
   - 可以添加多个预设（如 cpp + python）

5. **自定义文件类型（可选）**
   - 选择过滤模式：白名单/黑名单/无
   - 在输入框中输入扩展名（如 txt）
   - 点击"添加"按钮
   - 重复添加多个扩展名

6. **确认设置**
   - 勾选"启用此备份源"
   - 点击"确定"按钮

7. **保存配置**
   - 返回设置对话框
   - 点击"保存"按钮

### 编辑现有备份源

1. **打开设置**
   - 右键托盘图标 → "备份设置"

2. **选择要编辑的源**
   - 在列表中点击选中

3. **点击"配置"按钮**
   - 打开源配置对话框

4. **修改设置**
   - 修改路径、预设、文件类型等

5. **保存更改**
   - 点击"确定"
   - 点击"保存"

### 快速启用/禁用

- 在设置对话框的列表中双击备份源
- ✓ 表示启用
- ✗ 表示禁用

## 配置示例

### 示例 1：备份 C++ 项目
```
路径: D:\Projects\MyProject
启用: ✓
预设: cpp
模式: 白名单
扩展名: .cpp, .h, .hpp, .cmake
```

### 示例 2：备份文档（排除临时文件）
```
路径: D:\Documents
启用: ✓
预设: 无
模式: 黑名单
扩展名: .tmp, .bak, .log
```

### 示例 3：备份单个重要文件
```
路径: D:\important\config.json
启用: ✓
预设: 无
模式: 无
```

### 示例 4：多预设组合
```
路径: D:\Projects\FullStack
启用: ✓
预设: cpp, python, web
模式: 无
```

## 技术细节

### 配置存储
所有配置保存在 `config.json` 中：

```json
{
  "backup_sources": [
    {
      "path": "D:\\Projects\\MyProject",
      "enabled": true,
      "presets": ["cpp"],
      "custom_filter": {
        "mode": "whitelist",
        "extensions": [".cpp", ".h", ".hpp"]
      }
    }
  ]
}
```

### 过滤优先级
1. 如果设置了 `custom_filter`，使用自定义过滤
2. 否则，使用 `presets` 中的预设
3. 多个预设会自动合并

### 文件 vs 文件夹
- 文件夹：递归监控所有子文件
- 单个文件：只监控该文件的变化

## 界面截图说明

### 源配置对话框布局
```
┌─────────────────────────────────────────────────────────┐
│ 路径或文件: [________________] [选择文件夹] [选择文件]  │
│ □ 启用此备份源                                          │
├─────────────────────────────────────────────────────────┤
│ 可用预设 (双击添加):    │ 自定义文件类型过滤:           │
│ ┌──────────────────┐    │ 模式: [白名单 ▼]              │
│ │ default          │    │ 文件扩展名:                   │
│ │ cpp              │    │ ┌──────────────┐              │
│ │ python           │    │ │ .cpp         │              │
│ │ web              │    │ │ .h           │              │
│ │ ...              │    │ │ .hpp         │              │
│ └──────────────────┘    │ └──────────────┘              │
│ [添加预设]              │ [____] [添加] [删除]          │
├─────────────────────────────────────────────────────────┤
│                                      [确定]    [取消]    │
└─────────────────────────────────────────────────────────┘
```

## 注意事项

1. **路径验证**：确保输入的路径或文件存在
2. **扩展名格式**：会自动添加点号，输入 cpp 或 .cpp 都可以
3. **预设冲突**：多个预设的规则会合并，不会冲突
4. **保存配置**：修改后必须点击"保存"才会写入配置文件
5. **监控更新**：修改配置后需要重启监控服务才能生效

## 下一步优化建议

- [ ] 添加预设预览功能
- [ ] 支持拖放文件/文件夹
- [ ] 添加配置导入/导出
- [ ] 支持正则表达式过滤
- [ ] 添加配置验证和错误提示
