# 如何修改 CodeBackup 应用图标

## 快速开始

已经为你配置好了图标系统，现在只需要：

### 1. 准备图标文件

当前使用的是 `resources/favicon.ico`。你可以：
- 直接替换这个文件，或
- 使用新的 .ico 文件

### 2. 替换图标（推荐方式）

```cmd
# 将你的图标文件复制到 resources 目录，命名为 favicon.ico
copy 你的图标.ico resources\favicon.ico
```

### 3. 重新编译

```cmd
# 清理旧的构建
cmake --build build --target clean

# 重新编译
cmake --build build --config Release
```

### 4. 运行程序

编译完成后，运行 `build\Release\codebackup_gui.exe`，你会在系统托盘看到新图标。

## 使用不同的图标文件名

如果你想使用不同的文件名（比如 `my_icon.ico`）：

1. 将图标文件放到 `resources/` 目录
2. 编辑 `resources/app_icon.rc`：
   ```rc
   // 应用程序图标资源文件
   #include "resource.h"

   IDI_ICON1 ICON "my_icon.ico"
   ```
3. 重新编译项目

## 图标制作建议

### 推荐尺寸
- 16x16 - 系统托盘小图标
- 32x32 - 系统托盘标准图标
- 48x48 - 任务栏图标
- 256x256 - 高分辨率显示

### 在线工具
- [ICO Converter](https://www.icoconverter.com/) - PNG 转 ICO
- [Favicon.io](https://favicon.io/) - 快速生成图标
- [RealFaviconGenerator](https://realfavicongenerator.net/) - 多平台图标生成

### 使用 Photoshop/GIMP
1. 创建多个尺寸的图片（16x16, 32x32, 48x48, 256x256）
2. 导出为 .ico 格式
3. 确保包含透明通道（32位色深）

## 故障排除

### 图标没有更新？

1. **清理构建缓存**
   ```cmd
   cmake --build build --target clean
   cmake --build build --config Release
   ```

2. **检查文件路径**
   - 确保 `resources/favicon.ico` 存在
   - 检查 `resources/app_icon.rc` 中的文件名是否正确

3. **验证图标格式**
   - 必须是 .ico 格式（不是 .png 或 .jpg）
   - 包含多个尺寸
   - 使用 32 位色深

4. **查看编译输出**
   - 检查是否有资源编译错误
   - 确认 `resources/app_icon.rc` 被包含在编译中

### 图标显示为默认图标？

这说明自定义图标加载失败，程序回退到系统默认图标。检查：
- 图标文件是否存在于正确位置
- 图标文件是否损坏
- 重新编译项目

## 技术说明

### 代码位置
- 图标加载代码：`src/gui_app.cpp` 的 `createTrayIcon()` 方法
- 资源定义：`resources/app_icon.rc`
- 资源 ID：`resources/resource.h`

### 资源 ID
- `IDI_ICON1` = 101

### 修改代码
如果需要修改图标加载逻辑，编辑 `src/gui_app.cpp`：

```cpp
void GuiApp::createTrayIcon() {
    // ...
    // 加载自定义图标
    HICON hIcon = LoadIcon(GetModuleHandle(nullptr), MAKEINTRESOURCE(101));
    if (hIcon) {
        nid_.hIcon = hIcon;
    } else {
        // 回退到系统默认图标
        nid_.hIcon = LoadIcon(nullptr, IDI_APPLICATION);
    }
    // ...
}
```

## 更多信息

详细的资源文件说明请查看 `resources/README.md`。
