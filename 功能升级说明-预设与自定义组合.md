# åŠŸèƒ½å‡çº§è¯´æ˜ - é¢„è®¾ä¸è‡ªå®šä¹‰è¿‡æ»¤å™¨ç»„åˆ

## ğŸ‰ é‡å¤§æ›´æ–°

### æ–°åŠŸèƒ½æ¦‚è¿°

1. âœ… **æ”¯æŒé¢„è®¾å’Œè‡ªå®šä¹‰è¿‡æ»¤å™¨åŒæ—¶ä½¿ç”¨**
2. âœ… **æ”¯æŒåŒæ—¶è®¾ç½®ç™½åå•å’Œé»‘åå•ï¼ˆåŒåˆ—è¡¨æ¨¡å¼ï¼‰**
3. âœ… **æ™ºèƒ½åˆå¹¶è§„åˆ™ï¼Œå†²çªæ—¶è‡ªå®šä¹‰ä¼˜å…ˆ**
4. âœ… **å®Œå…¨å‘åå…¼å®¹æ—§é…ç½®**

---

## ğŸ“‹ ä»£ç ä¿®æ”¹æ¸…å•

### 1. æ•°æ®ç»“æ„å‡çº§

#### `include/backup_handler.h`

**ä¿®æ”¹å‰**ï¼š
```cpp
struct FilterConfig {
    enum class Mode { None, Whitelist, Blacklist };
    Mode mode = Mode::None;
    std::vector<std::string> extensions;
};
```

**ä¿®æ”¹å**ï¼š
```cpp
struct FilterConfig {
    enum class Mode { None, Whitelist, Blacklist };
    Mode mode = Mode::None;
    std::vector<std::string> extensions;
    
    // æ–°å¢ï¼šæ”¯æŒåŒæ—¶è®¾ç½®ç™½åå•å’Œé»‘åå•
    std::vector<std::string> whitelist_extensions;
    std::vector<std::string> blacklist_extensions;
    
    // åˆ¤æ–­æ˜¯å¦ä½¿ç”¨æ–°çš„åŒåˆ—è¡¨æ¨¡å¼
    bool useDualMode() const {
        return !whitelist_extensions.empty() || !blacklist_extensions.empty();
    }
};
```

---

### 2. é…ç½®åŠ è½½å‡çº§

#### `src/config_loader.cpp`

**æ–°å¢åŠŸèƒ½**ï¼š
- æ”¯æŒåŠ è½½ `whitelist` å’Œ `blacklist` å­—æ®µ
- å…¼å®¹æ—§çš„ `mode` å’Œ `extensions` å­—æ®µ
- æ–°å¢ `mergeFilters()` å‡½æ•°ï¼Œæ™ºèƒ½åˆå¹¶é¢„è®¾å’Œè‡ªå®šä¹‰è¿‡æ»¤å™¨

**å…³é”®ä»£ç **ï¼š
```cpp
FilterConfig ConfigLoader::mergeFilters(
    const std::vector<std::string>& preset_names,
    const nlohmann::json& presets,
    const std::optional<FilterConfig>& custom_filter) {
    
    // 1. ä»é¢„è®¾ä¸­æ”¶é›†ç™½åå•å’Œé»‘åå•
    // 2. å¦‚æœæœ‰è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œæ™ºèƒ½åˆå¹¶
    // 3. è‡ªå®šä¹‰ç™½åå•è¦†ç›–é¢„è®¾ç™½åå•
    // 4. è‡ªå®šä¹‰é»‘åå•ä¸é¢„è®¾é»‘åå•åˆå¹¶
}
```

---

### 3. è¿‡æ»¤é€»è¾‘å‡çº§

#### `src/backup_handler.cpp`

**ä¿®æ”¹å‰**ï¼š
```cpp
bool BackupHandler::isAllowed(const std::string& file_path) const {
    if (filter_config_.mode == FilterConfig::Mode::None) {
        return true;
    }
    // åªæ”¯æŒå•ä¸€æ¨¡å¼ï¼ˆç™½åå•æˆ–é»‘åå•ï¼‰
}
```

**ä¿®æ”¹å**ï¼š
```cpp
bool BackupHandler::isAllowed(const std::string& file_path) const {
    // ä¼˜å…ˆä½¿ç”¨åŒåˆ—è¡¨æ¨¡å¼
    if (filter_config_.useDualMode()) {
        // è§„åˆ™ï¼š
        // 1. å¦‚æœåœ¨é»‘åå•ä¸­ â†’ æ‹’ç»
        // 2. å¦‚æœæœ‰ç™½åå•ä¸”ä¸åœ¨ç™½åå•ä¸­ â†’ æ‹’ç»
        // 3. å…¶ä»–æƒ…å†µ â†’ å…è®¸
    }
    
    // å…¼å®¹æ—§çš„å•æ¨¡å¼
    // ...
}
```

---

### 4. GUI æ”¯æŒï¼ˆéƒ¨åˆ†å®ç°ï¼‰

#### `src/gui_app.cpp`

**æ–°å¢æ§ä»¶ID**ï¼š
```cpp
#define IDC_LIST_WHITELIST 2034
#define IDC_LIST_BLACKLIST 2035
#define IDC_EDIT_WHITELIST_EXT 2036
#define IDC_EDIT_BLACKLIST_EXT 2037
#define IDC_BTN_ADD_WHITELIST 2038
#define IDC_BTN_ADD_BLACKLIST 2039
#define IDC_BTN_REMOVE_WHITELIST 2040
#define IDC_BTN_REMOVE_BLACKLIST 2041
#define IDC_CHECK_USE_DUAL_MODE 2042
```

**æ–°å¢æŒ‰é’®å¤„ç†**ï¼š
- `IDC_BTN_ADD_WHITELIST` - æ·»åŠ ç™½åå•æ‰©å±•å
- `IDC_BTN_ADD_BLACKLIST` - æ·»åŠ é»‘åå•æ‰©å±•å
- `IDC_BTN_REMOVE_WHITELIST` - åˆ é™¤ç™½åå•æ‰©å±•å
- `IDC_BTN_REMOVE_BLACKLIST` - åˆ é™¤é»‘åå•æ‰©å±•å

**ä¿å­˜é€»è¾‘å‡çº§**ï¼š
```cpp
// ä¼˜å…ˆä¿å­˜åŒåˆ—è¡¨æ¨¡å¼
if (source.custom_filter->useDualMode()) {
    if (!source.custom_filter->whitelist_extensions.empty()) {
        filter_json["whitelist"] = source.custom_filter->whitelist_extensions;
    }
    if (!source.custom_filter->blacklist_extensions.empty()) {
        filter_json["blacklist"] = source.custom_filter->blacklist_extensions;
    }
}
```

---

### 5. ç›‘æ§çº¿ç¨‹å‡çº§

#### `src/gui_app.cpp` - `monitoringThread()`

**ä¿®æ”¹å‰**ï¼š
```cpp
FilterConfig filter_config;
if (source.custom_filter) {
    filter_config = *source.custom_filter;
} else if (!source.presets.empty()) {
    filter_config = ConfigLoader::mergePresets(source.presets, presets_);
}
```

**ä¿®æ”¹å**ï¼š
```cpp
// ä½¿ç”¨æ–°çš„åˆå¹¶å‡½æ•°ï¼Œæ”¯æŒé¢„è®¾å’Œè‡ªå®šä¹‰è¿‡æ»¤å™¨åŒæ—¶ä½¿ç”¨
FilterConfig filter_config = ConfigLoader::mergeFilters(
    source.presets, 
    presets_, 
    source.custom_filter
);
```

---

## ğŸ¯ é…ç½®æ ¼å¼

### æ—§æ ¼å¼ï¼ˆä»ç„¶æ”¯æŒï¼‰

```json
{
  "path": "D:\\Projects",
  "enabled": true,
  "presets": ["code"],
  "filter": {
    "mode": "whitelist",
    "extensions": [".py", ".js"]
  }
}
```

### æ–°æ ¼å¼ - åŒåˆ—è¡¨æ¨¡å¼

```json
{
  "path": "D:\\Projects",
  "enabled": true,
  "presets": ["code", "common_blacklist"],
  "filter": {
    "whitelist": [".py", ".js", ".cpp"],
    "blacklist": [".pyc", ".log", ".tmp"]
  }
}
```

### æ–°æ ¼å¼ - é¢„è®¾ + è‡ªå®šä¹‰é»‘åå•

```json
{
  "path": "D:\\Projects",
  "enabled": true,
  "presets": ["code"],
  "filter": {
    "blacklist": [".pyc", ".log"]
  }
}
```

---

## ğŸ”„ åˆå¹¶è§„åˆ™

### è§„åˆ™ 1ï¼šåªæœ‰é¢„è®¾
```json
"presets": ["code", "common_blacklist"]
```
- åˆå¹¶æ‰€æœ‰é¢„è®¾çš„ç™½åå•å’Œé»‘åå•
- ç™½åå•ä¼˜å…ˆçº§é«˜äºé»‘åå•

### è§„åˆ™ 2ï¼šé¢„è®¾ + è‡ªå®šä¹‰ç™½åå•
```json
"presets": ["code"],
"filter": {
  "whitelist": [".py", ".js"]
}
```
- **è‡ªå®šä¹‰ç™½åå•è¦†ç›–é¢„è®¾ç™½åå•**
- é¢„è®¾é»‘åå•ä»ç„¶ç”Ÿæ•ˆ

### è§„åˆ™ 3ï¼šé¢„è®¾ + è‡ªå®šä¹‰é»‘åå•
```json
"presets": ["code"],
"filter": {
  "blacklist": [".log", ".tmp"]
}
```
- ä½¿ç”¨é¢„è®¾ç™½åå•
- **åˆå¹¶**é¢„è®¾é»‘åå•å’Œè‡ªå®šä¹‰é»‘åå•

### è§„åˆ™ 4ï¼šé¢„è®¾ + åŒåˆ—è¡¨
```json
"presets": ["code"],
"filter": {
  "whitelist": [".py", ".js"],
  "blacklist": [".pyc", ".log"]
}
```
- è‡ªå®šä¹‰ç™½åå•è¦†ç›–é¢„è®¾ç™½åå•
- åˆå¹¶é¢„è®¾é»‘åå•å’Œè‡ªå®šä¹‰é»‘åå•

---

## ğŸ” åˆ¤æ–­æµç¨‹

### åŒåˆ—è¡¨æ¨¡å¼

```
æ–‡ä»¶: test.py

Step 1: æ£€æŸ¥é»‘åå•
â”œâ”€ åœ¨é»‘åå•ä¸­? â†’ âŒ æ‹’ç»
â””â”€ ä¸åœ¨é»‘åå•ä¸­ â†’ ç»§ç»­ Step 2

Step 2: æ£€æŸ¥ç™½åå•
â”œâ”€ æœ‰ç™½åå•?
â”‚  â”œâ”€ åœ¨ç™½åå•ä¸­? â†’ âœ… å…è®¸
â”‚  â””â”€ ä¸åœ¨ç™½åå•ä¸­? â†’ âŒ æ‹’ç»
â””â”€ æ²¡æœ‰ç™½åå•? â†’ âœ… å…è®¸
```

### ç¤ºä¾‹

**é…ç½®**ï¼š
```json
"filter": {
  "whitelist": [".py", ".js"],
  "blacklist": [".pyc"]
}
```

**åˆ¤æ–­ç»“æœ**ï¼š
- `test.py` â†’ âœ… å…è®¸ï¼ˆåœ¨ç™½åå•ï¼Œä¸åœ¨é»‘åå•ï¼‰
- `test.pyc` â†’ âŒ æ‹’ç»ï¼ˆåœ¨é»‘åå•ï¼‰
- `test.js` â†’ âœ… å…è®¸ï¼ˆåœ¨ç™½åå•ï¼Œä¸åœ¨é»‘åå•ï¼‰
- `test.txt` â†’ âŒ æ‹’ç»ï¼ˆä¸åœ¨ç™½åå•ï¼‰

---

## âœ… å‘åå…¼å®¹æ€§

### æ—§é…ç½®å®Œå…¨å…¼å®¹

æ‰€æœ‰æ—§çš„é…ç½®æ ¼å¼éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼š

1. **åªç”¨é¢„è®¾**ï¼š
```json
"presets": ["code"]
```

2. **åªç”¨è‡ªå®šä¹‰ï¼ˆå•æ¨¡å¼ï¼‰**ï¼š
```json
"filter": {
  "mode": "whitelist",
  "extensions": [".py"]
}
```

3. **é¢„è®¾ + è‡ªå®šä¹‰ï¼ˆæ—§æ–¹å¼ï¼‰**ï¼š
```json
"presets": ["code"],
"filter": {
  "mode": "blacklist",
  "extensions": [".log"]
}
```

### è‡ªåŠ¨æ£€æµ‹æ¨¡å¼

ä»£ç ä¼šè‡ªåŠ¨æ£€æµ‹ä½¿ç”¨å“ªç§æ¨¡å¼ï¼š
- å¦‚æœæœ‰ `whitelist` æˆ– `blacklist` å­—æ®µ â†’ ä½¿ç”¨åŒåˆ—è¡¨æ¨¡å¼
- å¦åˆ™ä½¿ç”¨æ—§çš„å•æ¨¡å¼

---

## ğŸ› æµ‹è¯•å»ºè®®

### æµ‹è¯•åœºæ™¯ 1ï¼šé¢„è®¾ + è‡ªå®šä¹‰é»‘åå•

**é…ç½®**ï¼š
```json
{
  "path": "D:\\Test",
  "enabled": true,
  "presets": ["code"],
  "filter": {
    "blacklist": [".log"]
  }
}
```

**æµ‹è¯•æ–‡ä»¶**ï¼š
- `test.py` â†’ åº”è¯¥å¤‡ä»½ï¼ˆcodeé¢„è®¾åŒ…å«.pyï¼‰
- `test.js` â†’ åº”è¯¥å¤‡ä»½ï¼ˆcodeé¢„è®¾åŒ…å«.jsï¼‰
- `test.log` â†’ ä¸åº”è¯¥å¤‡ä»½ï¼ˆåœ¨é»‘åå•ä¸­ï¼‰
- `test.txt` â†’ ä¸åº”è¯¥å¤‡ä»½ï¼ˆä¸åœ¨codeé¢„è®¾ä¸­ï¼‰

### æµ‹è¯•åœºæ™¯ 2ï¼šåŒåˆ—è¡¨æ¨¡å¼

**é…ç½®**ï¼š
```json
{
  "path": "D:\\Test",
  "enabled": true,
  "presets": [],
  "filter": {
    "whitelist": [".py", ".js"],
    "blacklist": [".pyc"]
  }
}
```

**æµ‹è¯•æ–‡ä»¶**ï¼š
- `test.py` â†’ åº”è¯¥å¤‡ä»½
- `test.pyc` â†’ ä¸åº”è¯¥å¤‡ä»½ï¼ˆåœ¨é»‘åå•ï¼‰
- `test.js` â†’ åº”è¯¥å¤‡ä»½
- `test.txt` â†’ ä¸åº”è¯¥å¤‡ä»½ï¼ˆä¸åœ¨ç™½åå•ï¼‰

---

## ğŸ“Š æ€§èƒ½å½±å“

### åˆ¤æ–­å¤æ‚åº¦

| æ¨¡å¼ | æ—¶é—´å¤æ‚åº¦ | è¯´æ˜ |
|------|------------|------|
| æ— è¿‡æ»¤ | O(1) | ç›´æ¥è¿”å›true |
| å•æ¨¡å¼ | O(n) | nä¸ºæ‰©å±•åæ•°é‡ |
| åŒåˆ—è¡¨ | O(n+m) | nä¸ºç™½åå•æ•°é‡ï¼Œmä¸ºé»‘åå•æ•°é‡ |

### ä¼˜åŒ–å»ºè®®

1. æ‰©å±•ååˆ—è¡¨ä¸è¦å¤ªé•¿ï¼ˆ< 50ä¸ªï¼‰
2. ä¼˜å…ˆä½¿ç”¨é¢„è®¾ï¼ˆé¢„ç¼–è¯‘å¥½çš„ï¼‰
3. é¿å…è¿‡äºå¤æ‚çš„ç»„åˆ

---

## ğŸ“ æ–‡æ¡£æ›´æ–°

### æ–°å¢æ–‡æ¡£

1. **é¢„è®¾ä¸è‡ªå®šä¹‰è¿‡æ»¤å™¨ç»„åˆä½¿ç”¨è¯´æ˜.md**
   - è¯¦ç»†çš„é…ç½®æ–¹å¼
   - å®é™…åº”ç”¨åœºæ™¯
   - åˆ¤æ–­é€»è¾‘è¯´æ˜

2. **åŠŸèƒ½å‡çº§è¯´æ˜-é¢„è®¾ä¸è‡ªå®šä¹‰ç»„åˆ.md**ï¼ˆæœ¬æ–‡æ¡£ï¼‰
   - ä»£ç ä¿®æ”¹æ¸…å•
   - é…ç½®æ ¼å¼è¯´æ˜
   - æµ‹è¯•å»ºè®®

### éœ€è¦æ›´æ–°çš„æ–‡æ¡£

1. **è‡ªå®šä¹‰è¿‡æ»¤å™¨é…ç½®è¯´æ˜.md**
   - æ·»åŠ åŒåˆ—è¡¨æ¨¡å¼è¯´æ˜
   - æ·»åŠ ç»„åˆä½¿ç”¨ç¤ºä¾‹

2. **å¿«é€Ÿé…ç½®å‚è€ƒ.md**
   - æ·»åŠ æ–°çš„é…ç½®æ¨¡æ¿
   - æ›´æ–°é…ç½®å¯¹æ¯”è¡¨

3. **å¤‡ä»½é…ç½®æ–‡ä»¶/README.md**
   - æ·»åŠ åŒåˆ—è¡¨æ¨¡å¼è¯´æ˜
   - æ›´æ–°ç¤ºä¾‹é…ç½®

---

## ğŸ“ ä½¿ç”¨å»ºè®®

### åˆå­¦è€…

ä»ç®€å•å¼€å§‹ï¼š
```json
"presets": ["code", "common_blacklist"]
```

### è¿›é˜¶ç”¨æˆ·

æ·»åŠ è‡ªå®šä¹‰é»‘åå•ï¼š
```json
"presets": ["code", "common_blacklist"],
"filter": {
  "blacklist": [".pyc", ".log"]
}
```

### é«˜çº§ç”¨æˆ·

ä½¿ç”¨åŒåˆ—è¡¨ç²¾ç¡®æ§åˆ¶ï¼š
```json
"presets": [],
"filter": {
  "whitelist": [".py", ".js", ".cpp"],
  "blacklist": [".pyc", ".min.js", ".o"]
}
```

---

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### GUI ç•Œé¢å®Œå–„ï¼ˆå¯é€‰ï¼‰

1. æ·»åŠ "åŒåˆ—è¡¨æ¨¡å¼"å¤é€‰æ¡†
2. æ·»åŠ ç™½åå•å’Œé»‘åå•çš„ç‹¬ç«‹åˆ—è¡¨æ¡†
3. æ·»åŠ åˆ‡æ¢æ¨¡å¼çš„åŠŸèƒ½
4. æ·»åŠ é¢„è§ˆåŠŸèƒ½ï¼Œæ˜¾ç¤ºæœ€ç»ˆçš„è¿‡æ»¤è§„åˆ™

### åŠŸèƒ½å¢å¼ºï¼ˆå¯é€‰ï¼‰

1. æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
2. æ”¯æŒæ–‡ä»¶å¤§å°è¿‡æ»¤
3. æ”¯æŒæ–‡ä»¶ä¿®æ”¹æ—¶é—´è¿‡æ»¤
4. æ”¯æŒè·¯å¾„æ¨¡å¼åŒ¹é…

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### ç›¸å…³æ–‡ä»¶

- **é…ç½®æ–‡ä»¶**ï¼š`config.json`
- **é¢„è®¾æ–‡ä»¶**ï¼š`presets.json`
- **æ—¥å¿—æ–‡ä»¶**ï¼š`å¤‡ä»½ç›®å½•/æ—¥æœŸ/backup_log_*.log`

### ç›¸å…³æ–‡æ¡£

- `é¢„è®¾ä¸è‡ªå®šä¹‰è¿‡æ»¤å™¨ç»„åˆä½¿ç”¨è¯´æ˜.md`
- `è‡ªå®šä¹‰è¿‡æ»¤å™¨é…ç½®è¯´æ˜.md`
- `å¿«é€Ÿé…ç½®å‚è€ƒ.md`
- `å¤‡ä»½é…ç½®æ–‡ä»¶/README.md`

---

## ğŸ‰ æ€»ç»“

### æ ¸å¿ƒæ”¹è¿›

âœ… **çµæ´»æ€§**ï¼šé¢„è®¾å’Œè‡ªå®šä¹‰å¯ä»¥ç»„åˆä½¿ç”¨  
âœ… **å¼ºå¤§æ€§**ï¼šæ”¯æŒåŒæ—¶è®¾ç½®ç™½åå•å’Œé»‘åå•  
âœ… **æ™ºèƒ½æ€§**ï¼šè‡ªåŠ¨åˆå¹¶è§„åˆ™ï¼Œå†²çªæ—¶è‡ªå®šä¹‰ä¼˜å…ˆ  
âœ… **å…¼å®¹æ€§**ï¼šå®Œå…¨å‘åå…¼å®¹æ—§é…ç½®  

### ç”¨æˆ·æ”¶ç›Š

- æ›´çµæ´»çš„é…ç½®æ–¹å¼
- æ›´ç²¾ç¡®çš„æ–‡ä»¶æ§åˆ¶
- æ›´ç®€å•çš„é…ç½®ç®¡ç†
- æ— éœ€æ‹…å¿ƒå…¼å®¹æ€§é—®é¢˜

---

**ç°åœ¨ä½ å¯ä»¥è‡ªç”±ç»„åˆé¢„è®¾å’Œè‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œå®ç°æœ€ç²¾ç¡®çš„å¤‡ä»½æ§åˆ¶ï¼** ğŸ‰
